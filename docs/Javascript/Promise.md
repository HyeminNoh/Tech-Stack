# ES6ë¬¸ë²• - Promise
*written by sohyeon, hyemin ðŸ’¡*

<br>

## 1. Promiseëž€?

ìžë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ í•˜ë‚˜ì˜ íŒ¨í„´ìœ¼ë¡œ ì½œë°±í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤. í•˜ì§€ë§Œ ì „í†µì ì¸ ì½œë°± íŒ¨í„´ì€ ê°€ë…ì„±ì´ ë‚˜ì˜ê³  **ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘ ë°œìƒí•œ ì—ëŸ¬ì˜ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ê³¤ëž€**í•˜ë©° ì—¬ëŸ¬ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§ì„ í•œêº¼ë²ˆì— ì²˜ë¦¬í•˜ëŠ” ê²ƒë„ í•œê³„ê°€ ìžˆë‹¤.  
ES6ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë˜ ë‹¤ë¥¸ íŒ¨í„´ìœ¼ë¡œ í”„ë¡œë¯¸ìŠ¤(Promise)ë¥¼ ë„ìž…í–ˆë‹¤. ì½œë°± íŒ¨í„´ì´ ê°€ì§„ ë‹¨ì ì„ ë³´ì™„í•˜ë©° **ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì ì„ ëª…í™•í•˜ê²Œ í‘œí˜„í•œë‹¤.**  

## 2. ìƒì„±

í”„ë¡œë¯¸ìŠ¤ëŠ” ìƒì„±ìž í•¨ìˆ˜ë¥¼ í†µí•´ ì¸ìŠ¤í„´ìŠ¤í™” í•œë‹¤.  
Promise ìƒì„±ìž í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ìž‘ì—…ì„ ìˆ˜í–‰í•  ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ì „ë‹¬ë°›ëŠ”ë°  
ì´ ì½œë°± í•¨ìˆ˜ëŠ” resolveì™€ reject í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ì „ë‹¬ ë°›ëŠ”ë‹¤.  

```Javascript
// Promise ê°ì²´ì˜ ìƒì„±
const promise = new Promise((resolve, reject) => {
  // ë¹„ë™ê¸° ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

  if (/* ë¹„ë™ê¸° ìž‘ì—… ìˆ˜í–‰ ì„±ê³µ */) {
    resolve('result');
  }
  else { /* ë¹„ë™ê¸° ìž‘ì—… ìˆ˜í–‰ ì‹¤íŒ¨ */
    reject('failure reason');
  }
}
```
PromiseëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µ(fulfilled)í•˜ì˜€ëŠ”ì§€ ë˜ëŠ” ì‹¤íŒ¨(rejected)í•˜ì˜€ëŠ”ì§€ ë“±ì˜ ìƒíƒœ(state) ì •ë³´ë¥¼ ê°–ëŠ”ë‹¤.  

Promise ìƒì„±ìž í•¨ìˆ˜ê°€ ì¸ìžë¡œ ì „ë‹¬ë°›ì€ ì½œë°± í•¨ìˆ˜ëŠ” ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.  
ì´ë•Œ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ `ì„±ê³µ`í•˜ë©´ ì½œë°± í•¨ìˆ˜ì˜ ì¸ìžë¡œ ì „ë‹¬ë°›ì€ resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.  
ì´ë•Œ í”„ë¡œë¯¸ìŠ¤ëŠ” `fulfilled`(ë¹„ë™ê¸° ì²˜ë¦¬ ìˆ˜í–‰ ì„±ê³µ) ìƒíƒœê°€ ëœë‹¤.  
ë¹„ë™ê¸° ì²˜ë¦¬ê°€ `ì‹¤íŒ¨`í•˜ë©´ `reject` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë•Œ í”„ë¡œë¯¸ìŠ¤ëŠ” `rejected`(ë¹„ë™ê¸° ì²˜ë¦¬ ìˆ˜í–‰ ì‹¤íŒ¨) ìƒíƒœê°€ ëœë‹¤.  

### 2-1. ì˜ˆì‹œ
```Javascript
const promiseAjax = (method, url, payload) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open(method, url);
    xhr.setRequestHeader('Content-type', 'application/json');
    xhr.send(JSON.stringify(payload));

    xhr.onreadystatechange = function () {
      // ì„œë²„ ì‘ë‹µ ì™„ë£Œê°€ ì•„ë‹ˆë©´ ë¬´ì‹œ
      if (xhr.readyState !== XMLHttpRequest.DONE) return;

      if (xhr.status >= 200 && xhr.status < 400) {
        // resolve ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì „ë‹¬
        resolve(xhr.response); // Success!
      } else {
        // reject ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì „ë‹¬
        reject(new Error(xhr.status)); // Failed...
      }
    };
  });
};
```
ìœ„ ì˜ˆì œì²˜ëŸ¼ ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ì—ì„œ Promise ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê·¸ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ êµ¬í˜„í•œë‹¤. ì´ë•Œ ë¹„ë™ê¸° ì²˜ë¦¬ì— ì„±ê³µí•˜ë©´ resolve ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë•Œ resolve ë©”ì†Œë“œì˜ ì¸ìžë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì „ë‹¬í•œë‹¤. ì´ ì²˜ë¦¬ ê²°ê³¼ëŠ” Promise ê°ì²´ì˜ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œë¡œ ì „ë‹¬ëœë‹¤.  
ë§Œì•½ ë¹„ë™ê¸° ì²˜ë¦¬ì— ì‹¤íŒ¨í•˜ë©´ reject ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ì´ë•Œ reject ë©”ì†Œë“œì˜ ì¸ìžë¡œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•œë‹¤. ì´ ì—ëŸ¬ ë©”ì‹œì§€ëŠ” Promise ê°ì²´ì˜ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œë¡œ ì „ë‹¬ëœë‹¤.

## 3. í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œ

Promiseë¡œ êµ¬í˜„ëœ ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” Promise ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ì•¼ í•œë‹¤.   Promiseë¡œ êµ¬í˜„ëœ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ `í˜¸ì¶œí•˜ëŠ” ì¸¡`(promise consumer)ì—ì„œëŠ” Promise ê°ì²´ì˜ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œ(then, catch)ë¥¼ í†µí•´ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ ë˜ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì „ë‹¬ë°›ì•„ ì²˜ë¦¬í•œë‹¤. Promise ê°ì²´ëŠ” ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤ê³  í•˜ì˜€ë‹¤. ì´ **ìƒíƒœì— ë”°ë¼ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œë¥¼ ì²´ì´ë‹ ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ**í•œë‹¤. Promiseì˜ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œëŠ” ì•„ëž˜ì™€ ê°™ë‹¤.

* `then ë©”ì†Œë“œ`  
    ë‘ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ì „ë‹¬ ë°›ëŠ”ë‹¤.  
    ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” ì„±ê³µ(fulfilled, resolve í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œë˜ê³   
    ë‘ ë²ˆì§¸ í•¨ìˆ˜ëŠ” ì‹¤íŒ¨(rejected, reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œëœë‹¤.  
    then ë©”ì†Œë“œëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤.

* `catch ë©”ì†Œë“œ`  
    ì˜ˆì™¸(ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ì™€ then ë©”ì†Œë“œì—ì„œ ë°œìƒí•œ ì—ëŸ¬)ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œëœë‹¤.  
    catch ë©”ì†Œë“œëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤.  

### 3-1. ì˜ˆì‹œ
```Javascript
/*
    ë¹„ë™ê¸° í•¨ìˆ˜ promiseAjaxì€ Promise ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
    Promise ê°ì²´ì˜ í›„ì† ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ì— ëŒ€í•œ í›„ì† ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
*/
promiseAjax('GET', 'http://jsonplaceholder.typicode.com/posts/1')
  .then(JSON.parse)
  .then(
  // ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” ì„±ê³µ(fulfilled, resolve í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œëœë‹¤.
  render,
  // ë‘ ë²ˆì§¸ í•¨ìˆ˜ëŠ” ì‹¤íŒ¨(rejected, reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ) ì‹œ í˜¸ì¶œëœë‹¤.
  console.error
);

```

## 4. ì—ëŸ¬ ì²˜ë¦¬

ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œ ë°œìƒí•œ ì—ëŸ¬ ë©”ì‹œì§€ëŠ” `then ë©”ì†Œë“œì˜ ë‘ ë²ˆì§¸ ì½œë°± í•¨ìˆ˜`ë¡œ ì „ë‹¬ëœë‹¤.  
Promise ê°ì²´ì˜ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œ `catch`ë¥¼ ì‚¬ìš©í•´ë„ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìžˆë‹¤.

### ì˜ˆì œ
```Javascript
promiseAjax('GET', 'http://jsonplaceholder.typicode.com/posts/1')
  .then(JSON.parse)
  .then(render)
  .catch(console.error);
```

then ë©”ì†Œë“œì˜ ë‘ ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ë°œìƒí•œ ì—ëŸ¬(reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ)ë§Œì„ ìºì¹˜í•œë‹¤.  
í•˜ì§€ë§Œ catch ë©”ì†Œë“œëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ë°œìƒí•œ ì—ëŸ¬(reject í•¨ìˆ˜ê°€ í˜¸ì¶œëœ ìƒíƒœ)ë¿ë§Œ ì•„ë‹ˆë¼ then ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë„ ìºì¹˜í•œë‹¤.  
ë”°ë¼ì„œ ì—ëŸ¬ ì²˜ë¦¬ëŠ” catch ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” íŽ¸ì´ ë³´ë‹¤ íš¨ìœ¨ì ì´ë‹¤.  

## 5. í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹

ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë‹¤ë¥¸ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ê²½ìš°,  
í•¨ìˆ˜ì˜ í˜¸ì¶œì´ ì¤‘ì²©(nesting)ì´ ë˜ì–´ ë³µìž¡ë„ê°€ ë†’ì•„ì§€ëŠ” `ì½œë°± í—¬`ì´ ë°œìƒí•œë‹¤. **í”„ë¡œë¯¸ìŠ¤ëŠ” í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œë¥¼ ì²´ì´ë‹(chainning)í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤**. ì´ë¡œì¨ ì½œë°± í—¬ì„ í•´ê²°í•œë‹¤.

Promise ê°ì²´ë¥¼ ë°˜í™˜í•œ ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ í›„ì† ì²˜ë¦¬ ë©”ì†Œë“œì¸ thenì´ë‚˜ catch ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.  
ë”°ë¼ì„œ then ë©”ì†Œë“œê°€ Promise ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ í•˜ë©´(then ë©”ì†Œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Promiseë¥¼ ë°˜í™˜í•œë‹¤.) ì—¬ëŸ¬ ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì—°ê²°í•´ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.

<br>

## Reference & Additional Resources
* [í”„ë¡œë¯¸ìŠ¤](https://poiemaweb.com/es6-promise)